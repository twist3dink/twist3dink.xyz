<!DOCTYPE html>
<html lang="en">
<head>
    <script>if(window.location.pathname.endsWith(".html")){window.location.replace(window.location.pathname.slice(0,-5)+"/");}</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson 4: Infrared Control Mastery | tw¬°st3d_¬°nk Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #0a0a0a;
      --bg-card: #1a1a1a;
      --accent: #00ff88;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --border: #333;
    }

    body {
      font-family: 'Atkinson Hyperlegible', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.8;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    /* Accessibility Controls */
    .a11y-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 15px;
      z-index: 1000;
      display: flex;
      gap: 10px;
    }

    .a11y-btn {
      background: var(--bg-dark);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .a11y-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .a11y-btn:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Navigation */
    .lesson-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: color 0.3s ease;
    }

    .nav-link:hover {
      color: var(--accent);
    }

    .lesson-badge {
      background: var(--bg-card);
      border: 2px solid var(--accent);
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 700;
      color: var(--accent);
    }

    /* Header */
    .lesson-header {
      margin-bottom: 40px;
    }

    .lesson-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 15px;
      background: linear-gradient(135deg, var(--accent), #00ccff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .lesson-meta {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Content Sections */
    .content-section {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .section-subtitle {
      font-size: 1.3rem;
      font-weight: 700;
      margin-top: 25px;
      margin-bottom: 15px;
      color: var(--text-primary);
    }

    p {
      margin-bottom: 15px;
      color: var(--text-secondary);
    }

    /* Alert Boxes */
    .alert {
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px solid;
    }

    .alert-info {
      background: rgba(0, 255, 136, 0.1);
      border-color: var(--accent);
      color: var(--accent);
    }

    .alert-title {
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Lists */
    ul, ol {
      margin-left: 25px;
      margin-bottom: 20px;
      color: var(--text-secondary);
    }

    li {
      margin-bottom: 10px;
      line-height: 1.7;
    }

    /* Progress Footer */
    .lesson-footer {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-top: 40px;
    }

    .completion-section {
      text-align: center;
    }

    .xp-reward {
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 10px;
    }

    .complete-btn {
      background: var(--accent);
      color: var(--bg-dark);
      border: none;
      padding: 15px 40px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .complete-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 24px rgba(0, 255, 136, 0.4);
    }

    .complete-btn:disabled {
      background: var(--border);
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
    }

    .nav-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .nav-btn {
      background: var(--bg-dark);
      color: var(--accent);
      border: 2px solid var(--accent);
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .nav-btn:hover {
      background: var(--accent);
      color: var(--bg-dark);
    }

    /* Font Size Classes */
    body.font-small { font-size: 14px; }
    body.font-large { font-size: 18px; }
    body.font-xl { font-size: 22px; }

    /* High Contrast Mode */
    body.high-contrast {
      --bg-dark: #000000;
      --bg-card: #1a1a1a;
      --text-primary: #ffffff;
      --border: #00ff88;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .lesson-title {
        font-size: 2rem;
      }

      .a11y-controls {
        position: static;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Accessibility Controls -->
    <div class="a11y-controls">
      <button class="a11y-btn" onclick="changeFontSize('small')" aria-label="Decrease font size">A-</button>
      <button class="a11y-btn" onclick="changeFontSize('normal')" aria-label="Normal font size">A</button>
      <button class="a11y-btn" onclick="changeFontSize('large')" aria-label="Increase font size">A+</button>
      <button class="a11y-btn" onclick="changeFontSize('xl')" aria-label="Extra large font size">A++</button>
      <button class="a11y-btn" onclick="toggleContrast()" aria-label="Toggle high contrast">‚óê</button>
    </div>

    <!-- Navigation -->
    <nav class="lesson-nav">
      <a href="../../" class="nav-link">‚Üê Back to Course</a>
      <span class="lesson-badge">LESSON 4</span>
      <a href="../lesson-5/" class="nav-link">Next Lesson ‚Üí</a>
    </nav>

    <!-- Lesson Header -->
    <header class="lesson-header">
      <h1 class="lesson-title">Infrared Control Mastery</h1>
      <div class="lesson-meta">
        <span class="meta-item">‚è±Ô∏è 35 minutes</span>
        <span class="meta-item">‚ö° 50 XP</span>
        <span class="meta-item">üì∂ Difficulty: Beginner</span>
      </div>
    </header>

    <!-- Introduction -->
    <section class="content-section">
      <h2 class="section-title">üì° Introduction to Infrared</h2>
      
      <p>Infrared (IR) communication is one of the oldest and most ubiquitous wireless technologies. From TV remotes to air conditioners, projectors to stereo systems, IR controls are everywhere. The Flipper Zero's infrared capabilities turn it into a universal remote control with learning and replay features.</p>

      <p>In this lesson, you'll learn how IR communication works, how to capture signals from existing remotes, and how to use the Flipper Zero as a universal controller for IR-enabled devices.</p>

      <div class="alert alert-info">
        <div class="alert-title">üí° Fun Fact</div>
        <p>IR remotes have been around since the 1950s! The technology remains popular because it's simple, cheap, and doesn't require pairing or batteries in the receiver.</p>
      </div>
    </section>

    <!-- How IR Works -->
    <section class="content-section">
      <h2 class="section-title">üî¨ How Infrared Communication Works</h2>

      <h3 class="section-subtitle">The Basics of IR</h3>
      <p>Infrared is electromagnetic radiation with wavelengths longer than visible light but shorter than radio waves. Most consumer IR devices use wavelengths around 940 nanometers, which is invisible to the human eye but visible to cameras and the Flipper Zero's IR receiver.</p>

      <h3 class="section-subtitle">IR Signal Components</h3>
      <ul>
        <li><strong>Carrier Frequency</strong> - Typically 38 kHz (sometimes 36, 40, or 56 kHz)</li>
        <li><strong>Modulation</strong> - The carrier is turned on/off in specific patterns</li>
        <li><strong>Protocol</strong> - Standard encoding schemes (NEC, RC5, RC6, SIRC, Samsung, etc.)</li>
        <li><strong>Command Data</strong> - Binary data representing specific button presses</li>
      </ul>

      <h3 class="section-subtitle">How a Remote Works</h3>
      <ol>
        <li><strong>Button Press</strong> - You press a button on the remote</li>
        <li><strong>Encode</strong> - Microcontroller converts button to protocol-specific data</li>
        <li><strong>Modulate</strong> - Data modulates the 38 kHz carrier wave</li>
        <li><strong>Transmit</strong> - IR LED sends the modulated signal</li>
        <li><strong>Receive</strong> - Device's IR receiver demodulates the signal</li>
        <li><strong>Decode</strong> - Device interprets the command and performs action</li>
      </ol>

      <h3 class="section-subtitle">Common IR Protocols</h3>
      <ul>
        <li><strong>NEC</strong> - Popular protocol used by many Asian manufacturers</li>
        <li><strong>RC5/RC6</strong> - Philips protocol, common in European devices</li>
        <li><strong>SIRC</strong> - Sony Infrared Remote Control protocol</li>
        <li><strong>Samsung</strong> - Protocol used by Samsung devices</li>
        <li><strong>Raw</strong> - Direct timing data when protocol is unknown</li>
      </ul>
    </section>

    <!-- Learning IR Signals -->
    <section class="content-section">
      <h2 class="section-title">üìñ Learning IR Signals</h2>

      <h3 class="section-subtitle">Step-by-Step: Capturing a Remote</h3>
      <ol>
        <li>Navigate to <strong>Infrared</strong> from the main menu</li>
        <li>Select <strong>Learn New Remote</strong></li>
        <li>Point your existing remote at the Flipper's IR receiver (top of device)</li>
        <li>Press the button you want to capture</li>
        <li>The Flipper will display the captured signal and protocol</li>
        <li>Name the button (e.g., "Power", "Vol+", "Ch Up")</li>
        <li>Repeat for all buttons you want to capture</li>
        <li>Save the complete remote file</li>
      </ol>

      <h3 class="section-subtitle">Tips for Successful Capture</h3>
      <ul>
        <li>Hold the remote 2-5 cm away from the Flipper's IR receiver</li>
        <li>Point directly at the receiver (top center of Flipper)</li>
        <li>Press buttons firmly and hold briefly</li>
        <li>If capture fails, try adjusting distance and angle</li>
        <li>Some remotes may need fresh batteries for strong signals</li>
      </ul>

      <div class="alert alert-info">
        <div class="alert-title">üí° Pro Tip</div>
        <p>You can see IR signals with your smartphone camera! Point the remote at your phone's camera and press a button - you'll see the IR LED light up on screen.</p>
      </div>

      <h3 class="section-subtitle">Understanding Captured Data</h3>
      <p>When the Flipper captures an IR signal, it displays:</p>
      <ul>
        <li><strong>Protocol Name</strong> - If recognized (NEC, RC5, etc.)</li>
        <li><strong>Address</strong> - Device identifier code</li>
        <li><strong>Command</strong> - Specific button command code</li>
        <li><strong>Raw Timing</strong> - If protocol is unknown</li>
      </ul>
    </section>

    <!-- Using Captured Remotes -->
    <section class="content-section">
      <h2 class="section-title">üéÆ Using Captured Remotes</h2>

      <h3 class="section-subtitle">Transmitting Saved Commands</h3>
      <ol>
        <li>Go to <strong>Infrared</strong> ‚Üí <strong>Saved Remotes</strong></li>
        <li>Select your saved remote file</li>
        <li>Choose the button you want to send</li>
        <li>Point Flipper's IR transmitter (bottom) at the device</li>
        <li>Press OK to send the command</li>
      </ol>

      <h3 class="section-subtitle">Universal Remotes</h3>
      <p>The Flipper comes with pre-loaded universal remote databases for common devices:</p>
      <ul>
        <li><strong>TVs</strong> - Power, volume, channel controls for major brands</li>
        <li><strong>Audio Systems</strong> - Stereo and speaker controls</li>
        <li><strong>Projectors</strong> - Common projector commands</li>
        <li><strong>Air Conditioners</strong> - Temperature and mode controls</li>
      </ul>

      <p>To use universal remotes:</p>
      <ol>
        <li>Go to <strong>Infrared</strong> ‚Üí <strong>Universal Remotes</strong></li>
        <li>Select device type (TV, Audio, etc.)</li>
        <li>Try different brand profiles until one works</li>
        <li>Save the working profile for future use</li>
      </ol>

      <div class="alert alert-info">
        <div class="alert-title">üí° Quick Trick</div>
        <p>At a restaurant or bar with TVs? Use the universal TV remote to find the power button. Most TVs respond to one of the universal profiles!</p>
      </div>
    </section>

    <!-- Advanced Features -->
    <section class="content-section">
      <h2 class="section-title">‚ö° Advanced IR Features</h2>

      <h3 class="section-subtitle">Raw Signal Capture</h3>
      <p>When the Flipper can't identify a protocol, it captures raw timing data:</p>
      <ul>
        <li>Records exact on/off timing of IR pulses</li>
        <li>Works with any IR device, even proprietary protocols</li>
        <li>Larger file sizes than protocol-based captures</li>
        <li>Perfect for unusual or custom IR devices</li>
      </ul>

      <h3 class="section-subtitle">Brute Force Mode</h3>
      <p>For TV power control, you can try all known TV power commands:</p>
      <ol>
        <li>Go to <strong>Infrared</strong> ‚Üí <strong>Universal Remotes</strong> ‚Üí <strong>TVs</strong></li>
        <li>Select a brand or use "All"</li>
        <li>Choose <strong>Power</strong> button</li>
        <li>The Flipper will cycle through all known power codes</li>
        <li>Watch the TV - when it responds, note which code worked</li>
      </ol>

      <h3 class="section-subtitle">Debugging Signals</h3>
      <p>You can analyze captured signals in detail:</p>
      <ul>
        <li>View raw timing data</li>
        <li>Check protocol parameters</li>
        <li>Compare different captures of the same button</li>
        <li>Identify transmission errors or weak signals</li>
      </ul>
    </section>

    <!-- Practical Applications -->
    <section class="content-section">
      <h2 class="section-title">üéØ Practical Applications</h2>

      <h3 class="section-subtitle">Home Automation</h3>
      <ul>
        <li>Create custom remote layouts for your devices</li>
        <li>Combine multiple remotes into one</li>
        <li>Control devices that lost their original remotes</li>
        <li>Set up macro commands (future firmware feature)</li>
      </ul>

      <h3 class="section-subtitle">Security Research</h3>
      <ul>
        <li>Analyze IR security systems (within legal boundaries)</li>
        <li>Test IR-based access control</li>
        <li>Study protocol implementation differences</li>
        <li>Document proprietary IR protocols</li>
      </ul>

      <h3 class="section-subtitle">Backup & Recovery</h3>
      <ul>
        <li>Save all your remote controls before batteries die</li>
        <li>Create backups of hard-to-replace remotes</li>
        <li>Share remote files with friends/family</li>
        <li>Keep digital copies of remotes for moved/sold devices</li>
      </ul>
    </section>

    <!-- Practice Exercise -->
    <section class="content-section">
      <h2 class="section-title">üèãÔ∏è Practice Exercise</h2>

      <h3 class="section-subtitle">Build Your Universal Remote</h3>
      <p>Complete this hands-on exercise to master IR control:</p>

      <ol>
        <li><strong>Capture a TV Remote</strong>
          <ul>
            <li>Find a TV remote in your home</li>
            <li>Learn power, volume up/down, and channel up/down buttons</li>
            <li>Save as "My TV Remote"</li>
            <li>Test each button by controlling the TV</li>
          </ul>
        </li>

        <li><strong>Test Universal Remotes</strong>
          <ul>
            <li>Try the universal TV remote on different TVs</li>
            <li>Test audio controls on a stereo or soundbar</li>
            <li>Find which brands work with your devices</li>
          </ul>
        </li>

        <li><strong>Capture Another Device</strong>
          <ul>
            <li>Choose an air conditioner, fan, or other IR device</li>
            <li>Learn the most useful buttons</li>
            <li>Test signal strength at different distances</li>
            <li>Note maximum effective range</li>
          </ul>
        </li>

        <li><strong>Document Your Findings</strong>
          <ul>
            <li>Which protocols did your devices use?</li>
            <li>What was the maximum transmission range?</li>
            <li>Did any devices use raw/unknown protocols?</li>
            <li>How consistent were repeated captures?</li>
          </ul>
        </li>
      </ol>

      <div class="alert alert-info">
        <div class="alert-title">‚úÖ Success Criteria</div>
        <p>You've mastered this lesson when you can successfully capture, save, and replay IR commands from at least two different devices!</p>
      </div>
    </section>

    <!-- Lesson Footer -->
    <footer class="lesson-footer">
      <div class="completion-section">
        <div class="xp-reward">+50 XP</div>
        <p>Complete this lesson to earn your XP and unlock the next module!</p>
        <button class="complete-btn" id="completeBtn" onclick="markComplete()">
          Mark Lesson Complete
        </button>
        <div class="nav-buttons">
          <a href="../lesson-3/" class="nav-btn">‚Üê Previous Lesson</a>
          <a href="../../" class="nav-btn">Course Overview</a>
          <a href="../lesson-5/" class="nav-btn">Next Lesson ‚Üí</a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // Storage configuration - syncs with course overview
    const COURSE_STORAGE_KEY = 'flipper-zero-course';
    const LESSON_ID = 4;

    // Progress tracking functions
    async function loadProgress() {
      try {
        const result = await window.storage.get(COURSE_STORAGE_KEY);
        return result ? JSON.parse(result.value) : { completed: [] };
      } catch (error) {
        return { completed: [] };
      }
    }

    async function saveProgress(progress) {
      try {
        await window.storage.set(COURSE_STORAGE_KEY, JSON.stringify(progress));
        return true;
      } catch (error) {
        console.error('Failed to save progress:', error);
        return false;
      }
    }

    async function markComplete() {
      const btn = document.getElementById('completeBtn');
      btn.disabled = true;
      btn.textContent = 'Saving...';

      const progress = await loadProgress();
      
      if (!progress.completed.includes(LESSON_ID)) {
        progress.completed.push(LESSON_ID);
        const saved = await saveProgress(progress);
        
        if (saved) {
          btn.textContent = '‚úì Lesson Complete!';
          btn.style.background = 'var(--accent)';
          setTimeout(() => {
            window.location.href = '../lesson-5/';
          }, 1500);
        } else {
          btn.textContent = 'Error - Try Again';
          btn.disabled = false;
        }
      } else {
        btn.textContent = '‚úì Already Complete';
      }
    }

    // Check if already completed
    async function checkCompletion() {
      const progress = await loadProgress();
      if (progress.completed.includes(LESSON_ID)) {
        const btn = document.getElementById('completeBtn');
        btn.textContent = '‚úì Completed';
        btn.style.background = 'var(--border)';
      }
    }

    // Accessibility functions
    function changeFontSize(size) {
      document.body.className = document.body.className.replace(/font-\w+/g, '');
      if (size !== 'normal') {
        document.body.classList.add('font-' + size);
      }
      localStorage.setItem('fontSize', size);
    }

    function toggleContrast() {
      document.body.classList.toggle('high-contrast');
      localStorage.setItem('highContrast', document.body.classList.contains('high-contrast'));
    }

    function loadA11yPreferences() {
      const fontSize = localStorage.getItem('fontSize');
      if (fontSize && fontSize !== 'normal') {
        document.body.classList.add('font-' + fontSize);
      }

      const highContrast = localStorage.getItem('highContrast') === 'true';
      if (highContrast) {
        document.body.classList.add('high-contrast');
      }
    }

    // Initialize
    loadA11yPreferences();
    checkCompletion();
  </script>
</body>
</html>
