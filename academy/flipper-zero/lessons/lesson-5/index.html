<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson 5: BadUSB & Automation | tw¬°st3d_¬°nk Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #0a0a0a;
      --bg-card: #1a1a1a;
      --accent: #00ff88;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --border: #333;
      --warning: #ff9500;
    }

    body {
      font-family: 'Atkinson Hyperlegible', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.8;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    /* Accessibility Controls */
    .a11y-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 15px;
      z-index: 1000;
      display: flex;
      gap: 10px;
    }

    .a11y-btn {
      background: var(--bg-dark);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .a11y-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .a11y-btn:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Navigation */
    .lesson-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: color 0.3s ease;
    }

    .nav-link:hover {
      color: var(--accent);
    }

    .lesson-badge {
      background: var(--bg-card);
      border: 2px solid var(--accent);
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 700;
      color: var(--accent);
    }

    /* Header */
    .lesson-header {
      margin-bottom: 40px;
    }

    .lesson-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 15px;
      background: linear-gradient(135deg, var(--accent), #00ccff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .lesson-meta {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Content Sections */
    .content-section {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .section-subtitle {
      font-size: 1.3rem;
      font-weight: 700;
      margin-top: 25px;
      margin-bottom: 15px;
      color: var(--text-primary);
    }

    p {
      margin-bottom: 15px;
      color: var(--text-secondary);
    }

    /* Alert Boxes */
    .alert {
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px solid;
    }

    .alert-warning {
      background: rgba(255, 149, 0, 0.1);
      border-color: var(--warning);
      color: var(--warning);
    }

    .alert-info {
      background: rgba(0, 255, 136, 0.1);
      border-color: var(--accent);
      color: var(--accent);
    }

    .alert-title {
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Lists */
    ul, ol {
      margin-left: 25px;
      margin-bottom: 20px;
      color: var(--text-secondary);
    }

    li {
      margin-bottom: 10px;
      line-height: 1.7;
    }

    /* Code Blocks */
    .code-block {
      background: var(--bg-dark);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }

    .code-block code {
      color: var(--accent);
    }

    /* Progress Footer */
    .lesson-footer {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-top: 40px;
    }

    .completion-section {
      text-align: center;
    }

    .xp-reward {
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 10px;
    }

    .complete-btn {
      background: var(--accent);
      color: var(--bg-dark);
      border: none;
      padding: 15px 40px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .complete-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 24px rgba(0, 255, 136, 0.4);
    }

    .complete-btn:disabled {
      background: var(--border);
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
    }

    .nav-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .nav-btn {
      background: var(--bg-dark);
      color: var(--accent);
      border: 2px solid var(--accent);
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .nav-btn:hover {
      background: var(--accent);
      color: var(--bg-dark);
    }

    /* Font Size Classes */
    body.font-small { font-size: 14px; }
    body.font-large { font-size: 18px; }
    body.font-xl { font-size: 22px; }

    /* High Contrast Mode */
    body.high-contrast {
      --bg-dark: #000000;
      --bg-card: #1a1a1a;
      --text-primary: #ffffff;
      --border: #00ff88;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .lesson-title {
        font-size: 2rem;
      }

      .a11y-controls {
        position: static;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Accessibility Controls -->
    <div class="a11y-controls">
      <button class="a11y-btn" onclick="changeFontSize('small')" aria-label="Decrease font size">A-</button>
      <button class="a11y-btn" onclick="changeFontSize('normal')" aria-label="Normal font size">A</button>
      <button class="a11y-btn" onclick="changeFontSize('large')" aria-label="Increase font size">A+</button>
      <button class="a11y-btn" onclick="changeFontSize('xl')" aria-label="Extra large font size">A++</button>
      <button class="a11y-btn" onclick="toggleContrast()" aria-label="Toggle high contrast">‚óê</button>
    </div>

    <!-- Navigation -->
    <nav class="lesson-nav">
      <a href="../../" class="nav-link">‚Üê Back to Course</a>
      <span class="lesson-badge">LESSON 5</span>
      <a href="../lesson-6/" class="nav-link">Next Lesson ‚Üí</a>
    </nav>

    <!-- Lesson Header -->
    <header class="lesson-header">
      <h1 class="lesson-title">BadUSB & Automation</h1>
      <div class="lesson-meta">
        <span class="meta-item">‚è±Ô∏è 55 minutes</span>
        <span class="meta-item">‚ö° 50 XP</span>
        <span class="meta-item">üì∂ Difficulty: Advanced</span>
      </div>
    </header>

    <!-- Introduction -->
    <section class="content-section">
      <h2 class="section-title">‚å®Ô∏è Introduction to BadUSB</h2>
      
      <p>BadUSB is one of the most powerful features of the Flipper Zero. It allows the device to emulate a USB keyboard and automatically type commands at superhuman speed. This capability has legitimate uses in automation, system administration, and security testing.</p>

      <p>In this lesson, you'll learn how BadUSB works, how to create payloads using the DuckyScript language, and the ethical considerations of using this powerful tool.</p>

      <div class="alert alert-warning">
        <div class="alert-title">‚ö†Ô∏è Critical Warning</div>
        <p><strong>BadUSB can be used for malicious purposes and is illegal to use without authorization.</strong> Only use BadUSB on systems you own or have explicit written permission to test. Unauthorized computer access is a serious crime with severe penalties.</p>
      </div>
    </section>

    <!-- Understanding BadUSB -->
    <section class="content-section">
      <h2 class="section-title">üîç Understanding BadUSB Attacks</h2>

      <h3 class="section-subtitle">What is BadUSB?</h3>
      <p>BadUSB exploits the inherent trust computers place in USB devices. When you plug in a keyboard, the computer automatically accepts it and processes any keystrokes it sends. A BadUSB device masquerades as a keyboard to automatically execute commands.</p>

      <h3 class="section-subtitle">How It Works</h3>
      <ol>
        <li><strong>Connection</strong> - Flipper connects to computer via USB</li>
        <li><strong>Enumeration</strong> - Computer recognizes it as a keyboard (HID device)</li>
        <li><strong>Trust</strong> - Computer automatically accepts the "keyboard" without user approval</li>
        <li><strong>Execution</strong> - Flipper types commands at ~1000 characters per second</li>
        <li><strong>Payload</strong> - Pre-programmed script executes automatically</li>
      </ol>

      <h3 class="section-subtitle">Why It's Effective</h3>
      <ul>
        <li><strong>No Software Required</strong> - Works on any OS (Windows, Mac, Linux)</li>
        <li><strong>Fast Execution</strong> - Completes in seconds before user can react</li>
        <li><strong>Bypasses Security</strong> - No antivirus can detect keystrokes</li>
        <li><strong>Physical Access</strong> - Only requires brief USB port access</li>
        <li><strong>User Context</strong> - Runs with permissions of logged-in user</li>
      </ul>

      <div class="alert alert-info">
        <div class="alert-title">üí° Legitimate Uses</div>
        <p>BadUSB has many legitimate applications: system administration automation, computer setup scripts, security testing, accessibility tools, and rapid configuration deployment.</p>
      </div>
    </section>

    <!-- DuckyScript Language -->
    <section class="content-section">
      <h2 class="section-title">üìù DuckyScript Language</h2>

      <h3 class="section-subtitle">What is DuckyScript?</h3>
      <p>DuckyScript is a simple scripting language designed for USB keystroke injection. Originally created for the USB Rubber Ducky, it's now the standard language for BadUSB payloads. The Flipper Zero fully supports DuckyScript syntax.</p>

      <h3 class="section-subtitle">Basic Commands</h3>
      <ul>
        <li><strong>REM</strong> - Comment (not executed)</li>
        <li><strong>DELAY</strong> - Wait specified milliseconds</li>
        <li><strong>STRING</strong> - Type a string of text</li>
        <li><strong>ENTER</strong> - Press Enter key</li>
        <li><strong>CTRL, ALT, SHIFT, GUI</strong> - Modifier keys (GUI = Windows/Command key)</li>
        <li><strong>DOWNARROW, UPARROW, etc.</strong> - Arrow keys</li>
      </ul>

      <h3 class="section-subtitle">Example: Hello World</h3>
      <div class="code-block">
        <code>
REM Simple Hello World Script<br>
DELAY 1000<br>
GUI r<br>
DELAY 500<br>
STRING notepad<br>
ENTER<br>
DELAY 1000<br>
STRING Hello from Flipper Zero!<br>
ENTER
        </code>
      </div>
      <p>This script opens Notepad on Windows and types a message.</p>

      <h3 class="section-subtitle">Key Combinations</h3>
      <div class="code-block">
        <code>
REM Examples of key combinations<br>
CTRL ALT DELETE<br>
GUI d<br>
ALT F4<br>
CTRL SHIFT ESC
        </code>
      </div>

      <h3 class="section-subtitle">Timing is Critical</h3>
      <p>DELAY commands are essential for reliable payloads:</p>
      <ul>
        <li>Allow time for programs to open</li>
        <li>Wait for system dialogs</li>
        <li>Account for slow computers</li>
        <li>Prevent race conditions</li>
      </ul>
    </section>

    <!-- Creating Payloads -->
    <section class="content-section">
      <h2 class="section-title">üõ†Ô∏è Creating Your First Payload</h2>

      <h3 class="section-subtitle">Writing Payload Scripts</h3>
      <p>Payloads are simple text files with .txt extension stored on your Flipper's SD card:</p>
      <ol>
        <li>Create a text file on your computer</li>
        <li>Write your DuckyScript code</li>
        <li>Save with .txt extension</li>
        <li>Transfer to Flipper: <code>SD Card/badusb/</code> folder</li>
      </ol>

      <h3 class="section-subtitle">Example: System Info Grab (Windows)</h3>
      <div class="code-block">
        <code>
REM Get system information<br>
DELAY 1000<br>
GUI r<br>
DELAY 500<br>
STRING cmd<br>
ENTER<br>
DELAY 1000<br>
STRING systeminfo > %TEMP%\sysinfo.txt<br>
ENTER<br>
DELAY 2000<br>
STRING exit<br>
ENTER
        </code>
      </div>

      <h3 class="section-subtitle">Example: Quick Screenshot (Mac)</h3>
      <div class="code-block">
        <code>
REM Take screenshot on Mac<br>
DELAY 1000<br>
GUI SHIFT 3<br>
DELAY 500
        </code>
      </div>

      <h3 class="section-subtitle">Example: Open Website</h3>
      <div class="code-block">
        <code>
REM Open specific website<br>
DELAY 1000<br>
GUI r<br>
DELAY 500<br>
STRING https://example.com<br>
ENTER
        </code>
      </div>

      <div class="alert alert-info">
        <div class="alert-title">üí° Pro Tip</div>
        <p>Always test payloads on your own computer first! Start with longer delays, then optimize once you know it works reliably.</p>
      </div>
    </section>

    <!-- Running Payloads -->
    <section class="content-section">
      <h2 class="section-title">‚ñ∂Ô∏è Running BadUSB Payloads</h2>

      <h3 class="section-subtitle">Step-by-Step Execution</h3>
      <ol>
        <li>Navigate to <strong>Bad USB</strong> on your Flipper</li>
        <li>Select your payload script from the list</li>
        <li>Ensure target computer is at the desired starting point (desktop, login screen, etc.)</li>
        <li>Connect Flipper to target computer via USB</li>
        <li>Press OK on Flipper to execute the payload</li>
        <li>Watch as commands execute automatically</li>
        <li>Disconnect when complete</li>
      </ol>

      <h3 class="section-subtitle">Important Considerations</h3>
      <ul>
        <li><strong>Keyboard Layout</strong> - Ensure target computer uses same layout as your script</li>
        <li><strong>Computer Speed</strong> - Slower computers may need longer delays</li>
        <li><strong>Active Window</strong> - Make sure correct window has focus</li>
        <li><strong>Screen Lock</strong> - Won't work if computer is locked</li>
        <li><strong>User Context</strong> - Runs with current user's permissions</li>
      </ul>

      <h3 class="section-subtitle">Debugging Failed Payloads</h3>
      <ul>
        <li>Increase DELAY values</li>
        <li>Test each section individually</li>
        <li>Check keyboard layout compatibility</li>
        <li>Verify target OS matches your script</li>
        <li>Ensure necessary permissions exist</li>
      </ul>
    </section>

    <!-- Advanced Techniques -->
    <section class="content-section">
      <h2 class="section-title">‚ö° Advanced Payload Techniques</h2>

      <h3 class="section-subtitle">Cross-Platform Payloads</h3>
      <p>Create payloads that detect and adapt to the operating system:</p>
      <div class="code-block">
        <code>
REM This requires testing on each OS<br>
REM Windows-specific commands here<br>
GUI r<br>
DELAY 500<br>
STRING cmd<br>
ENTER
        </code>
      </div>

      <h3 class="section-subtitle">Exfiltration Techniques</h3>
      <p>Legitimate uses include backing up your own data or system testing:</p>
      <ul>
        <li>Upload to cloud storage (your own accounts only)</li>
        <li>Email to yourself</li>
        <li>Save to network share</li>
        <li>Create local copies in accessible locations</li>
      </ul>

      <h3 class="section-subtitle">Persistence (For Security Testing)</h3>
      <p>Understanding persistence helps defend against it:</p>
      <ul>
        <li>Startup folder additions</li>
        <li>Scheduled tasks</li>
        <li>Registry modifications</li>
        <li>Service creation</li>
      </ul>

      <div class="alert alert-warning">
        <div class="alert-title">‚ö†Ô∏è Ethical Reminder</div>
        <p>All advanced techniques should only be used on systems you own or have explicit authorization to test as part of legitimate security assessments.</p>
      </div>
    </section>

    <!-- Defenses -->
    <section class="content-section">
      <h2 class="section-title">üõ°Ô∏è Defending Against BadUSB</h2>

      <h3 class="section-subtitle">Prevention Strategies</h3>
      <ul>
        <li><strong>Physical Security</strong> - Never leave computers unlocked and unattended</li>
        <li><strong>USB Port Control</strong> - Disable unused USB ports or use port locks</li>
        <li><strong>Endpoint Protection</strong> - Use software that monitors USB connections</li>
        <li><strong>User Training</strong> - Educate users about USB threats</li>
        <li><strong>Screen Lock</strong> - Enable automatic screen lock after brief inactivity</li>
      </ul>

      <h3 class="section-subtitle">Detection Methods</h3>
      <ul>
        <li>Monitor for rapid keyboard input</li>
        <li>Log and alert on new USB device connections</li>
        <li>Use specialized anti-BadUSB software</li>
        <li>Review command history for suspicious activity</li>
        <li>Implement application whitelisting</li>
      </ul>

      <h3 class="section-subtitle">System Hardening</h3>
      <ul>
        <li>Require admin password for sensitive operations</li>
        <li>Disable command prompt/PowerShell for standard users</li>
        <li>Use application control policies</li>
        <li>Enable full disk encryption</li>
        <li>Keep systems fully patched</li>
      </ul>
    </section>

    <!-- Practice Exercise -->
    <section class="content-section">
      <h2 class="section-title">üéØ Practice Exercise</h2>

      <h3 class="section-subtitle">Safe BadUSB Practice</h3>
      <p>Complete these exercises on your own computer only:</p>

      <ol>
        <li><strong>Create Hello World Payload</strong>
          <ul>
            <li>Write a script that opens Notepad/TextEdit</li>
            <li>Types a message</li>
            <li>Saves the file to desktop</li>
            <li>Test and refine delays</li>
          </ul>
        </li>

        <li><strong>System Info Script</strong>
          <ul>
            <li>Create payload to gather system information</li>
            <li>Save output to a text file</li>
            <li>Open the file when complete</li>
            <li>Verify all information collected correctly</li>
          </ul>
        </li>

        <li><strong>Productivity Automation</strong>
          <ul>
            <li>Create a script that opens your daily work applications</li>
            <li>Arrange windows automatically</li>
            <li>Open specific websites or documents</li>
            <li>Time the execution and optimize</li>
          </ul>
        </li>

        <li><strong>Document Your Process</strong>
          <ul>
            <li>What challenges did you encounter?</li>
            <li>How did you determine optimal delays?</li>
            <li>What legitimate uses can you envision?</li>
            <li>How would you defend against your own payloads?</li>
          </ul>
        </li>
      </ol>

      <div class="alert alert-warning">
        <div class="alert-title">‚ö†Ô∏è Testing Reminder</div>
        <p>Only test payloads on your own devices. Never use BadUSB on anyone else's computer without explicit written permission. Save and backup your work before testing potentially disruptive payloads.</p>
      </div>
    </section>

    <!-- Lesson Footer -->
    <footer class="lesson-footer">
      <div class="completion-section">
        <div class="xp-reward">+50 XP</div>
        <p>Complete this lesson to earn your XP and unlock the final module!</p>
        <button class="complete-btn" id="completeBtn" onclick="markComplete()">
          Mark Lesson Complete
        </button>
        <div class="nav-buttons">
          <a href="../lesson-4/" class="nav-btn">‚Üê Previous Lesson</a>
          <a href="../../" class="nav-btn">Course Overview</a>
          <a href="../lesson-6/" class="nav-btn">Next Lesson ‚Üí</a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // Storage configuration - syncs with course overview
    const COURSE_STORAGE_KEY = 'flipper-zero-course';
    const LESSON_ID = 5;

    // Progress tracking functions
    async function loadProgress() {
      try {
        const result = await window.storage.get(COURSE_STORAGE_KEY);
        return result ? JSON.parse(result.value) : { completed: [] };
      } catch (error) {
        return { completed: [] };
      }
    }

    async function saveProgress(progress) {
      try {
        await window.storage.set(COURSE_STORAGE_KEY, JSON.stringify(progress));
        return true;
      } catch (error) {
        console.error('Failed to save progress:', error);
        return false;
      }
    }

    async function markComplete() {
      const btn = document.getElementById('completeBtn');
      btn.disabled = true;
      btn.textContent = 'Saving...';

      const progress = await loadProgress();
      
      if (!progress.completed.includes(LESSON_ID)) {
        progress.completed.push(LESSON_ID);
        const saved = await saveProgress(progress);
        
        if (saved) {
          btn.textContent = '‚úì Lesson Complete!';
          btn.style.background = 'var(--accent)';
          setTimeout(() => {
            window.location.href = '../lesson-6/';
          }, 1500);
        } else {
          btn.textContent = 'Error - Try Again';
          btn.disabled = false;
        }
      } else {
        btn.textContent = '‚úì Already Complete';
      }
    }

    // Check if already completed
    async function checkCompletion() {
      const progress = await loadProgress();
      if (progress.completed.includes(LESSON_ID)) {
        const btn = document.getElementById('completeBtn');
        btn.textContent = '‚úì Completed';
        btn.style.background = 'var(--border)';
      }
    }

    // Accessibility functions
    function changeFontSize(size) {
      document.body.className = document.body.className.replace(/font-\w+/g, '');
      if (size !== 'normal') {
        document.body.classList.add('font-' + size);
      }
      localStorage.setItem('fontSize', size);
    }

    function toggleContrast() {
      document.body.classList.toggle('high-contrast');
      localStorage.setItem('highContrast', document.body.classList.contains('high-contrast'));
    }

    function loadA11yPreferences() {
      const fontSize = localStorage.getItem('fontSize');
      if (fontSize && fontSize !== 'normal') {
        document.body.classList.add('font-' + fontSize);
      }

      const highContrast = localStorage.getItem('highContrast') === 'true';
      if (highContrast) {
        document.body.classList.add('high-contrast');
      }
    }

    // Initialize
    loadA11yPreferences();
    checkCompletion();
  </script>
</body>
</html>
