<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 5: Infrared Communication | Flipper Zero Course - tw¡st3d_¡nk Academy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Atkinson Hyperlegible', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .lesson-header {
            background: #1a1a1a;
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #333;
            margin-bottom: 2rem;
        }

        .lesson-header h1 {
            color: #00ff88;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .lesson-meta {
            color: #999;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .lesson-header button {
            background: transparent;
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Atkinson Hyperlegible', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .lesson-header button:hover {
            background: #00ff88;
            color: #0a0a0a;
        }

        .content-section {
            background: #1a1a1a;
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #333;
            margin-bottom: 2rem;
        }

        .content-section h2 {
            color: #00ff88;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .content-section h3 {
            color: #00ff88;
            font-size: 1.2rem;
            margin: 1.5rem 0 0.8rem 0;
        }

        .content-section p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            letter-spacing: 0.3px;
        }

        .content-section ul, .content-section ol {
            margin: 1rem 0 1rem 2rem;
        }

        .content-section li {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.3px;
        }

        .note-box {
            background: #1a1a1a;
            border-left: 4px solid #00ff88;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #2a1a1a;
            border-left: 4px solid #ff4444;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        #complete-btn {
            background: #00ff88;
            color: #0a0a0a;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Atkinson Hyperlegible', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            width: 100%;
            margin: 2rem 0;
            transition: all 0.3s;
        }

        #complete-btn:hover {
            background: #00dd77;
        }

        #complete-btn.completed {
            background: #333;
            color: #00ff88;
            border: 2px solid #00ff88;
            cursor: default;
        }

        #complete-btn.locked {
            background: #333;
            color: #666;
            border: 2px solid #666;
            cursor: not-allowed;
        }

        #complete-btn.error {
            background: #ff4444;
            color: #fff;
        }

        .nav-section {
            background: #1a1a1a;
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #333;
            margin-top: 2rem;
        }

        .nav-section button {
            background: transparent;
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Atkinson Hyperlegible', sans-serif;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            width: 100%;
            transition: all 0.3s;
        }

        .nav-section button:hover {
            background: #00ff88;
            color: #0a0a0a;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-buttons a {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 1rem;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s;
        }

        .nav-buttons a:nth-child(1),
        .nav-buttons a:nth-child(2) {
            background: transparent;
            border: 2px solid #00ff88;
            color: #00ff88;
        }

        .nav-buttons a:nth-child(1):hover,
        .nav-buttons a:nth-child(2):hover {
            background: #00ff88;
            color: #0a0a0a;
        }

        .nav-buttons a:nth-child(3) {
            background: #00ff88;
            color: #0a0a0a;
            border: 2px solid #00ff88;
        }

        .nav-buttons a:nth-child(3):hover {
            background: #00dd77;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
            }

            .lesson-header h1 {
                font-size: 1.5rem;
            }

            .content-section {
                padding: 1.5rem;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-buttons a {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lesson-header">
            <h1>Lesson 5: Infrared Communication</h1>
            <p class="lesson-meta">Estimated time: 20 minutes | XP Reward: 50</p>
            <button onclick="scrollToBottom()">Skip to Bottom ↓</button>
        </div>

        <div class="content-section">
            <h2>What is Infrared (IR)?</h2>
            <p>Infrared is a form of electromagnetic radiation with wavelengths longer than visible light but shorter than radio waves. While we can't see infrared with our naked eyes, specialized sensors (and your smartphone camera!) can detect it. IR has been the standard for remote control technology since the 1980s and remains widely used today.</p>

            <h3>Light-Based Communication</h3>
            <p>Unlike radio frequencies that can pass through walls, infrared is essentially light-based communication using wavelengths just beyond what humans can see. This has both advantages and limitations:</p>

            <p><strong>Advantages:</strong></p>
            <ul>
                <li>No radio frequency interference or regulatory concerns</li>
                <li>Simple, inexpensive technology</li>
                <li>Doesn't interfere with other electronic devices</li>
                <li>Confined to a room (signal doesn't pass through walls)</li>
            </ul>

            <p><strong>Limitations:</strong></p>
            <ul>
                <li>Requires line-of-sight between transmitter and receiver</li>
                <li>Limited range (typically 15-30 feet)</li>
                <li>Can be blocked by objects or bright sunlight</li>
                <li>One-way communication only (no feedback from device)</li>
            </ul>

            <h3>Line-of-Sight Required</h3>
            <p>Because infrared operates like visible light, it needs a clear path from the remote to the device. This is why you need to point your TV remote at the television and why it won't work if someone stands between you and the TV. However, IR can bounce off walls and ceilings, which is why remotes sometimes work at slight angles.</p>

            <h3>Common Uses</h3>
            <p>Infrared remote controls are everywhere in modern life:</p>
            <ul>
                <li><strong>Television Controls:</strong> Power, channel, volume, and menu navigation</li>
                <li><strong>Air Conditioners:</strong> Temperature, mode, fan speed, and timer settings</li>
                <li><strong>Media Devices:</strong> DVD/Blu-ray players, cable boxes, streaming devices</li>
                <li><strong>Audio Equipment:</strong> Stereos, soundbars, home theater systems</li>
                <li><strong>Projectors:</strong> Input selection, settings, and presentation controls</li>
                <li><strong>Fans and Lights:</strong> Some smart home devices still use IR</li>
            </ul>

            <div class="note-box">
                <strong>Quick Test:</strong> Want to see infrared in action? Point your TV remote at your smartphone camera and press a button. You'll see the IR LED flash on your phone's screen even though it's invisible to your eyes! This works because phone cameras can detect infrared wavelengths.
            </div>
        </div>

        <div class="content-section">
            <h2>How IR Remotes Work</h2>
            <p>Understanding the technology behind IR remotes helps you capture and replay signals more effectively.</p>

            <h3>Infrared LED Transmitter</h3>
            <p>Every remote control contains one or more infrared LEDs - special light-emitting diodes that produce infrared light when electricity flows through them. When you press a button on your remote:</p>

            <ol>
                <li>The remote's microcontroller generates a specific pattern of pulses</li>
                <li>These pulses turn the IR LED on and off rapidly</li>
                <li>The pattern encodes which button was pressed</li>
                <li>The IR LED broadcasts this pattern toward the device</li>
            </ol>

            <p>The receiver device has an IR sensor that detects these pulses, decodes the pattern, and executes the corresponding command.</p>

            <h3>Modulated Signals</h3>
            <p>IR remotes don't just turn the LED on and off - they modulate (rapidly pulse) the infrared light at a specific frequency, typically 38 kHz (38,000 times per second). This modulation helps the receiver distinguish remote signals from ambient infrared light sources like sunlight or incandescent bulbs.</p>

            <p>Think of it like this: the button press creates a pattern of long and short bursts, and each burst consists of thousands of rapid pulses at the carrier frequency. The receiver filters for this specific pulse frequency, making the system more reliable.</p>

            <h3>Protocol Differences</h3>
            <p>Different manufacturers developed various IR protocols over the years. Common protocols include:</p>

            <ul>
                <li><strong>NEC:</strong> Used by many Asian manufacturers, simple and reliable</li>
                <li><strong>RC5/RC6:</strong> Developed by Philips, used in European devices</li>
                <li><strong>Sony SIRC:</strong> Sony's proprietary protocol</li>
                <li><strong>Samsung:</strong> Used across Samsung's product lines</li>
            </ul>

            <p>Each protocol has different timing, bit encoding, and repeat behavior. Fortunately, Flipper Zero can learn and replay most protocols without you needing to know which one is being used.</p>

            <h3>Carrier Frequencies</h3>
            <p>While 38 kHz is the most common carrier frequency, some devices use alternatives:</p>
            <ul>
                <li><strong>36 kHz:</strong> Some older remotes</li>
                <li><strong>38 kHz:</strong> Industry standard, most common</li>
                <li><strong>40 kHz:</strong> Occasionally used to avoid interference</li>
                <li><strong>56 kHz:</strong> Some specialized equipment</li>
            </ul>

            <p>Flipper automatically detects the carrier frequency when learning signals, ensuring accurate playback.</p>
        </div>

        <div class="content-section">
            <h2>Flipper's IR Module</h2>
            <p>Navigate to the Infrared menu from Flipper's home screen to access three main functions:</p>

            <h3>Learn New Remote</h3>
            <p>This is your tool for capturing IR signals from any remote control you have. The process is straightforward:</p>

            <ol>
                <li>Select "Learn New Remote"</li>
                <li>Give your remote a name (e.g., "Living_Room_TV")</li>
                <li>Flipper will prompt you to point the remote at it and press a button</li>
                <li>Name each button as you capture it (Power, Vol+, Ch+, etc.)</li>
                <li>Repeat for all buttons you want to save</li>
                <li>Flipper saves all buttons as a single remote file</li>
            </ol>

            <p>The IR receiver is located at the top of Flipper Zero. For best results, hold your remote 1-3 inches away and point directly at the IR sensor when capturing signals.</p>

            <h3>Universal Remotes</h3>
            <p>Flipper comes pre-loaded with an extensive database of universal remote codes for common devices. This database includes:</p>

            <ul>
                <li>Major TV brands (Samsung, LG, Sony, Vizio, etc.)</li>
                <li>Projectors from various manufacturers</li>
                <li>Audio systems and soundbars</li>
                <li>Air conditioners</li>
                <li>Media players</li>
            </ul>

            <p>To use a universal remote:</p>
            <ol>
                <li>Navigate to "Universal Remotes"</li>
                <li>Select device type (TVs, Projectors, Audio, etc.)</li>
                <li>Choose your brand</li>
                <li>Test the commands on your device</li>
            </ol>

            <p>If the first brand profile doesn't work perfectly, many brands have multiple protocol variations in the database. Try different options until you find one that works reliably with your specific device.</p>

            <h3>Saved Remotes</h3>
            <p>Access your library of captured IR remotes. Each saved remote contains all the buttons you learned for that device. You can:</p>
            <ul>
                <li>Replay saved buttons</li>
                <li>Edit button names</li>
                <li>Add new buttons to existing remotes</li>
                <li>Delete unwanted buttons or entire remotes</li>
                <li>Organize remotes into folders</li>
            </ul>

            <div class="note-box">
                <strong>Organization Tip:</strong> Create folder structures like /infrared/living-room/, /infrared/bedroom/, etc. This makes finding the right remote much faster when you have dozens saved.
            </div>
        </div>

        <div class="content-section">
            <h2>Learning IR Signals</h2>
            <p>Let's walk through capturing a complete remote control with Flipper Zero.</p>

            <h3>Pointing Remote at Flipper</h3>
            <p>Proper positioning ensures clean signal capture:</p>
            <ul>
                <li>Hold the remote 1-3 inches from Flipper's top (where the IR LED is located)</li>
                <li>Point the remote's IR LED directly at Flipper</li>
                <li>Keep both devices steady during capture</li>
                <li>Avoid bright sunlight or strong artificial lighting which can interfere</li>
            </ul>

            <h3>Button-by-Button Capture</h3>
            <p>When learning a new remote, Flipper prompts you to capture each button individually. Here's the workflow:</p>

            <ol>
                <li><strong>Start learning mode:</strong> Select "Learn New Remote" and name it</li>
                <li><strong>Press remote button:</strong> Press and hold the button you want to capture for about 1 second</li>
                <li><strong>Wait for confirmation:</strong> Flipper displays signal strength and confirms capture</li>
                <li><strong>Name the button:</strong> Give it a clear name like "Power", "Vol_Up", "Input", etc.</li>
                <li><strong>Repeat:</strong> Continue for each button you want to save</li>
                <li><strong>Finish:</strong> Press Back when done to save the complete remote</li>
            </ol>

            <h3>Naming Buttons</h3>
            <p>Use consistent, descriptive names that make sense when you're browsing through saved remotes:</p>

            <p><strong>Good naming examples:</strong></p>
            <ul>
                <li>Power (not Pwr or On/Off)</li>
                <li>Vol_Up / Vol_Down (not V+ / V-)</li>
                <li>Ch_Up / Ch_Down</li>
                <li>Input / Source</li>
                <li>Menu / Settings</li>
                <li>Play / Pause</li>
                <li>Mute</li>
            </ul>

            <p>Avoid overly abbreviated names that you might forget later. Future you will appreciate clear labels!</p>

            <h3>Testing Captured Signals</h3>
            <p>After capturing buttons, immediately test them:</p>
            <ol>
                <li>Navigate to your saved remote</li>
                <li>Select a button to test</li>
                <li>Point Flipper at the device</li>
                <li>Press OK to transmit</li>
                <li>Verify the device responds correctly</li>
            </ol>

            <p>If a button doesn't work reliably, you can recapture it. Sometimes pressing the remote button longer or shorter during capture improves reliability.</p>

            <div class="note-box">
                <strong>Troubleshooting:</strong> If captured signals don't work, try capturing again from a closer distance, ensure fresh batteries in the remote, and verify you're pointing Flipper directly at the device when transmitting. Some devices have less sensitive IR receivers that require stronger signals.
            </div>
        </div>

        <div class="content-section">
            <h2>Universal Remote Database</h2>
            <p>One of Flipper's most immediately useful features is its pre-loaded universal remote database.</p>

            <h3>Pre-Loaded Brands</h3>
            <p>The universal remote database includes control codes for hundreds of devices across major brands. Coverage includes:</p>

            <p><strong>Televisions:</strong></p>
            <ul>
                <li>Samsung, LG, Sony, Vizio, TCL, Hisense, Panasonic, Philips, Sharp, Toshiba, and many more</li>
            </ul>

            <p><strong>Projectors:</strong></p>
            <ul>
                <li>Epson, BenQ, Optoma, ViewSonic, and other popular brands</li>
            </ul>

            <p><strong>Audio Systems:</strong></p>
            <ul>
                <li>Soundbars, receivers, and speaker systems from major manufacturers</li>
            </ul>

            <p><strong>Air Conditioners:</strong></p>
            <ul>
                <li>Common HVAC brands with standard IR controls</li>
            </ul>

            <h3>Basic Controls Available</h3>
            <p>Universal remotes typically include essential functions:</p>

            <ul>
                <li><strong>Power:</strong> Turn device on/off (sometimes separate On and Off commands)</li>
                <li><strong>Volume:</strong> Increase, decrease, and mute</li>
                <li><strong>Channel:</strong> Up and down navigation</li>
                <li><strong>Input/Source:</strong> Switch between HDMI, cable, etc.</li>
                <li><strong>Menu Navigation:</strong> Enter menus and navigate settings</li>
            </ul>

            <p>Note that universal remotes may not include every specialized function your original remote has, but they cover the most commonly used controls.</p>

            <h3>Testing Different Profiles</h3>
            <p>If the first universal remote profile doesn't work perfectly with your device:</p>

            <ol>
                <li>Try other protocol variations listed for your brand</li>
                <li>Some brands are compatible with other manufacturers' protocols (look for similar parent companies)</li>
                <li>Generic/universal profiles sometimes work across multiple brands</li>
                <li>When you find one that works, you can save it for quick access</li>
            </ol>

            <div class="note-box">
                <strong>Real-World Tip:</strong> Many hotel rooms, conference rooms, and public spaces use common TV brands. Having the universal remote database makes Flipper an incredibly convenient universal remote when you can't find the original or need to quickly adjust settings.
            </div>
        </div>

        <div class="content-section">
            <h2>Creating Custom Remotes</h2>
            <p>Beyond simply capturing existing remotes, you can create more advanced configurations.</p>

            <h3>Combining Signals from Multiple Remotes</h3>
            <p>You can create a unified "super remote" that combines buttons from different devices:</p>

            <p><strong>Example use case:</strong> Home theater control</p>
            <ul>
                <li>TV power from your television remote</li>
                <li>Volume from your soundbar remote</li>
                <li>Play/pause from your media player remote</li>
                <li>Input switching from your receiver remote</li>
            </ul>

            <p>To create a combined remote:</p>
            <ol>
                <li>Learn buttons from each individual remote as separate files</li>
                <li>Use a computer to edit the .ir files on your SD card</li>
                <li>Copy specific button codes into a new unified remote file</li>
                <li>Test thoroughly to ensure all commands work</li>
            </ol>

            <h3>Creating Macros</h3>
            <p>While Flipper doesn't natively support macros (sequences of commands), you can simulate them by:</p>
            <ul>
                <li>Manually pressing multiple buttons in sequence</li>
                <li>Creating custom .ir files with multiple commands (requires file editing)</li>
                <li>Using community firmware that adds macro support</li>
            </ul>

            <p>Common macro examples:</p>
            <ul>
                <li>"Movie Mode": TV power → Input HDMI1 → Soundbar power → Volume to preset level</li>
                <li>"Bedtime": TV power off → AC to sleep mode → Lights off</li>
            </ul>

            <h3>Organizing Your Library</h3>
            <p>As your collection of IR remotes grows, organization becomes important:</p>

            <p><strong>Folder structure example:</strong></p>
            <ul>
                <li>/infrared/living-room/ - TV, soundbar, AC</li>
                <li>/infrared/bedroom/ - TV, fan, lights</li>
                <li>/infrared/office/ - Projector, speakers</li>
                <li>/infrared/universal/ - Generic remotes for travel</li>
            </ul>

            <p>Use descriptive filenames that include brand and model when relevant: "Samsung_TV_UN55MU8000.ir" rather than just "TV.ir"</p>
        </div>

        <div class="content-section">
            <h2>Practical Applications</h2>
            <p>Infrared control with Flipper Zero has numerous legitimate and useful applications.</p>

            <h3>Universal Remote Replacement</h3>
            <p>The most obvious use case: Flipper can replace physical remote controls you've lost, broken, or simply want to consolidate. Benefits include:</p>
            <ul>
                <li>One device controls multiple electronics</li>
                <li>Always with you (unlike that remote that keeps disappearing in the couch)</li>
                <li>Can't run out of batteries at the worst moment</li>
                <li>Works with devices that never came with remotes</li>
            </ul>

            <h3>Home Automation Integration</h3>
            <p>Many smart home enthusiasts use Flipper for:</p>
            <ul>
                <li>Controlling "dumb" devices that only have IR remotes</li>
                <li>Integrating older equipment into modern automation systems</li>
                <li>Testing IR-controlled smart home components</li>
                <li>Backup control when WiFi or smart systems fail</li>
            </ul>

            <h3>Troubleshooting Remote Issues</h3>
            <p>Flipper helps diagnose remote control problems:</p>
            <ul>
                <li>Test if a remote is transmitting at all (view signal strength)</li>
                <li>Compare weak remotes to known good ones</li>
                <li>Verify which buttons on a failing remote still work</li>
                <li>Determine if the issue is the remote or the device receiver</li>
            </ul>

            <h3>Pranks (Ethical Considerations)</h3>
            <p>Yes, Flipper can control TVs in public spaces, which has led to various harmless pranks. However, consider the ethical implications:</p>

            <div class="warning-box">
                <strong>Think Before You Prank:</strong>
                <ul style="margin-top: 0.5rem;">
                    <li>Is it actually funny, or just annoying?</li>
                    <li>Could it disrupt something important (presentation, sports bar during a game)?</li>
                    <li>Will it cause confusion or distress to staff or other customers?</li>
                    <li>Could you get banned from the establishment?</li>
                </ul>
                <p style="margin-top: 0.5rem;">Respect others' spaces and time. What seems like a harmless joke to you might ruin someone else's experience or even get you in legal trouble for disrupting business operations.</p>
            </div>

            <p>If you must play around, stick to your own devices in your own space.</p>
        </div>

        <div class="content-section">
            <h2>Key Takeaway</h2>
            <p>Infrared technology represents one of the oldest forms of wireless remote control, yet it remains ubiquitous in consumer electronics. Understanding how IR communication works gives you practical skills for everyday problems - from replacing lost remotes to diagnosing device issues.</p>

            <p>Flipper Zero's IR capabilities make it an incredibly handy tool:</p>
            <ul>
                <li>Learn and store unlimited remote controls</li>
                <li>Access a vast database of universal remote codes</li>
                <li>Create custom configurations for complex setups</li>
                <li>Carry one device instead of juggling multiple remotes</li>
            </ul>

            <p>The skills you've learned in this lesson have immediate practical value - you can start using Flipper as a universal remote right now!</p>

            <div class="note-box">
                <strong>Fun Fact:</strong> The term "infrared" literally means "below red" - referring to how these wavelengths fall just below the visible red light in the electromagnetic spectrum. The IR LEDs in remotes typically emit light around 940 nanometers, just beyond what our eyes can detect.
            </div>

            <div class="note-box">
                <strong>Final Lesson Ahead:</strong> In Lesson 6, we'll explore the most advanced (and potentially risky) Flipper features - BadUSB and GPIO. These powerful capabilities require extra caution and responsibility, but they open up fascinating possibilities for automation and hardware interaction.
            </div>
        </div>

        <button id="complete-btn" onclick="markComplete()">Complete Previous Lesson First</button>

        <div class="nav-section">
            <button onclick="scrollToTop()">Back to Top ↑</button>
            <div class="nav-buttons">
                <a href="../lesson-4/">← Previous Lesson</a>
                <a href="../../">Course Overview</a>
                <a href="../lesson-6/">Next Lesson →</a>
            </div>
        </div>
    </div>

    <script>
        function scrollToBottom() {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'instant'
            });
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'instant'
            });
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('flipper-progress');
                return saved ? JSON.parse(saved) : { currentLesson: 1, completedLessons: [], totalXP: 0 };
            } catch (e) {
                console.error('Error loading progress:', e);
                return { currentLesson: 1, completedLessons: [], totalXP: 0 };
            }
        }

        function saveProgress(progress) {
            try {
                localStorage.setItem('flipper-progress', JSON.stringify(progress));
                return true;
            } catch (e) {
                console.error('Error saving progress:', e);
                return false;
            }
        }

        function markComplete() {
            const btn = document.getElementById('complete-btn');
            const currentLessonNumber = 5;
            const progress = loadProgress();
            
            if (!progress.completedLessons.includes(currentLessonNumber - 1)) {
                return;
            }
            
            if (!progress.completedLessons.includes(currentLessonNumber)) {
                progress.completedLessons.push(currentLessonNumber);
                progress.totalXP += 50;
                
                if (progress.currentLesson === currentLessonNumber) {
                    progress.currentLesson = currentLessonNumber + 1;
                }
                
                const saved = saveProgress(progress);
                
                if (saved) {
                    btn.textContent = '✓ Lesson Complete';
                    btn.classList.remove('locked');
                    btn.classList.add('completed');
                } else {
                    btn.textContent = 'Error - Try Again';
                    btn.classList.add('error');
                    setTimeout(() => {
                        btn.textContent = 'Mark Lesson as Complete';
                        btn.classList.remove('error');
                    }, 2000);
                }
            }
        }

        window.addEventListener('load', () => {
            const progress = loadProgress();
            const currentLessonNumber = 5;
            const btn = document.getElementById('complete-btn');
            
            if (progress.completedLessons.includes(currentLessonNumber)) {
                btn.textContent = '✓ Lesson Complete';
                btn.classList.add('completed');
            }
            else if (progress.completedLessons.includes(currentLessonNumber - 1)) {
                btn.textContent = 'Mark Lesson as Complete';
                btn.classList.remove('locked');
            }
            else {
                btn.textContent = 'Complete Previous Lesson First';
                btn.classList.add('locked');
            }
        });
    </script>
</body>
</html>
